<!DOCTYPE html>
<html lang="es">

{% load static %}

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Lerny</title>

    <!-- Custom fonts for this template -->
    <link href="{% static 'lerny/vendor/fontawesome-free/css/all.min.css' %}" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="{% static 'lerny/css/lerny-admin.css' %}" rel="stylesheet">

    <!-- searchPanes -->
    <link rel="stylesheet" href="https://cdn.datatables.net/searchpanes/1.0.1/css/searchPanes.dataTables.min.css">
    
    <!-- select -->
    <link href="https://cdn.datatables.net/select/1.3.1/css/select.dataTables.min.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">

     <!-- Bootstrap core JavaScript-->
     <script src="{% static 'lerny/vendor/jquery/jquery.min.js' %}"></script>
     <script src="{% static 'lerny/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
 
     <!-- Core plugin JavaScript-->
     <script src="{% static 'lerny/vendor/jquery-easing/jquery.easing.min.js' %}"></script>
 
     <!-- Custom scripts for all pages-->
     <script src="{% static 'lerny/js/admin-lerny.js' %}"></script>
 
     <!-- Page level plugins -->
     <script src="{% static 'lerny/vendor/datatables/jquery.dataTables.min.js' %}"></script>
     <script src="{% static 'lerny/vendor/datatables/dataTables.bootstrap4.min.js' %}"></script>

     <!-- Style -->
     <link rel="stylesheet" href="{% static '/lerny/css/main.css' %}">   
 
     <!-- searchPanes   -->
     <script src="https://cdn.datatables.net/searchpanes/1.3.0/js/dataTables.searchPanes.min.js"></script>
     
     <!-- select -->
     <script src="https://cdn.datatables.net/select/1.3.3/js/dataTables.select.min.js"></script> 
</head>

<body id="page-top">


    <div id="wrapper">

        <!-- SideBar -->
        {% include 'partials/sidebar.html' %}


        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- NavBar -->
                {% include 'partials/navbar.html' %}  

            </div>

            <!-- Begin Page Content -->
            <div class="container-fluid">

                {% block content %} {% endblock %}

            </div>

            <!-- Footer -->
            {% include 'partials/footer.html' %}

        </div>

    </div>

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">

        var table = null
    
        function filter() {
            var lerny_id = $( "#lerny_select" ).children("option:selected").val();
            var microlerny_id = $( "#microlerny_select" ).children("option:selected").val();
    
            table.ajax.url( '/api_lerny/lernydetail/?lerny_id=' + lerny_id +'&microlerny_id=' + microlerny_id).load();
            myBarChart.destroy();
            myBarChartCant.destroy();
            myBarChartProgress.destroy();
            myBarChartAvg.destroy();
    
            $.ajax({
              method: 'GET',
              url: '/api_lerny/lernydetail/?lerny_id=' + lerny_id +'&microlerny_id=' + microlerny_id,
              success: function(respuesta) {
                var data_pie = respuesta.approved;
                var data_micro = respuesta.info_micro;
                var name_micro = respuesta.name_micro;
                var cont_micro = respuesta.cont_micro;
                var progress_micro = respuesta.progress_micro;
                var average = respuesta.average_micro;
    
                 //Approved Students chart
                var ctx = document.getElementById("myBarChart");
                myBarChart = new Chart(ctx, {
                  type: 'bar',
                  data: {
                    labels: ["Aprobado", "No Aprobado"],
                    datasets: [{
                      label: "Porcentaje",
                      data: data_pie,
                      backgroundColor: ['#4e73df', '#BB86FC'],
                      hoverBackgroundColor: ['#2e59d9', '#BB86FC'],
                      borderColor: "#4e73df",
                  }],
              },
              options: {
                maintainAspectRatio: false,
                tooltips: {
                  backgroundColor: "rgb(255,255,255)",
                  bodyFontColor: "#858796",
                  borderColor: '#dddfeb',
                  borderWidth: 1,
                  xPadding: 15,
                  yPadding: 15,
                  displayColors: true,
                  caretPadding: 10,
              },
              legend: {
                  display: false
              },
                scales: {
                  xAxes: [{
                    gridLines: {
                      display: false,
                      drawBorder: false
                    },
                    ticks: {
                      maxTicksLimit: 6
                    },
                    maxBarThickness: 25,
                  }],
                  yAxes: [{
                    ticks: {
                      min: 0,
                      max: 100,
                      maxTicksLimit: 5,
                      padding: 10,
                      // Include a dollar sign in the ticks
                    },
                    gridLines: {
                      color: "rgb(234, 236, 244)",
                      zeroLineColor: "rgb(234, 236, 244)",
                      drawBorder: false,
                      borderDash: [2],
                      zeroLineBorderDash: [2]
                    }
                  }],
                },
          },
      });
    
                // student progress chart
                var ctx = document.getElementById("myBarChartCant");
                myBarChartCant = new Chart(ctx, {
                type: 'bar',
                data: {
                  labels: name_micro,
                  datasets: [{
                    label: "# Estudiantes",
                    data: cont_micro,
                    hoverBackgroundColor: ['#00A3EF'],
                    borderColor: "#E0F4FF",
                  }],
                },
                options: {
                  maintainAspectRatio: false,
                  tooltips: {
                    backgroundColor: "#FFFFFF",
                    bodyFontColor: "#858796",
                    borderColor: '#dddfeb',
                    borderWidth: 1,
                    xPadding: 15,
                    yPadding: 15,
                    displayColors: true,
                    caretPadding: 10,
                  },
                  legend: {
                    display: false
                  },
                  scales: {
                    xAxes: [{
                      gridLines: {
                        display: false,
                        drawBorder: false
                      },
                      ticks: {
                        maxTicksLimit: 6
                      },
                      maxBarThickness: 25,
                    }],
                    yAxes: [{
                      ticks: {
                        maxTicksLimit: 5,
                        padding: 10,
                      },
                      gridLines: {
                        color: "#000",
                        zeroLineColor: "#8551F4",
                        drawBorder: false,
                        borderDash: [2],
                        zeroLineBorderDash: [2]
                      }
                    }],
                  },
                },
              });
    
                //Students per module chart
                var ctx = document.getElementById("myBarChartProgress");
                myBarChartProgress = new Chart(ctx, {
                  type: 'bar',
                  data: {
                    labels: name_micro,
                    datasets: [{
                      label: "Progreso",
                      data: progress_micro,
                      hoverBackgroundColor: ['#2e59d9'],
                      borderColor: "#4e73df",
                    }],
                  },
                  options: {
                    maintainAspectRatio: false,
                    tooltips: {
                      backgroundColor: "rgb(255,255,255)",
                      bodyFontColor: "#858796",
                      borderColor: '#dddfeb',
                      borderWidth: 1,
                      xPadding: 15,
                      yPadding: 15,
                      displayColors: true,
                      caretPadding: 10,
                    },
                    legend: {
                      display: false
                    },
                    scales: {
                      xAxes: [{
                        gridLines: {
                          display: false,
                          drawBorder: false
                        },
                        ticks: {
                          maxTicksLimit: 6
                        },
                        maxBarThickness: 25,
                      }],
                      yAxes: [{
                        ticks: {
                          maxTicksLimit: 5,
                          padding: 10,
                        },
                        gridLines: {
                          color: "rgb(234, 236, 244)",
                          zeroLineColor: "rgb(234, 236, 244)",
                          drawBorder: false,
                          borderDash: [2],
                          zeroLineBorderDash: [2]
                        }
                      }],
                    },
                  },
                });
                
                //Average score chart
                var ctx = document.getElementById("myBarChartAvg");
                myBarChartAvg = new Chart(ctx, {
                type: 'bar',
                data: {
                  labels: name_micro,
                  datasets: [{
                    label: "Promedio",
                    data: average,
                    hoverBackgroundColor: ['#2e59d9'],
                    borderColor: "#4e73df",
                  }],
                },
                options: {
                  maintainAspectRatio: false,
                  tooltips: {
                    backgroundColor: "rgb(255,255,255)",
                    bodyFontColor: "#858796",
                    borderColor: '#dddfeb',
                    borderWidth: 1,
                    xPadding: 15,
                    yPadding: 15,
                    displayColors: true,
                    caretPadding: 10,
                  },
                  legend: {
                    display: false
                  },
                  scales: {
                    xAxes: [{
                      gridLines: {
                        display: false,
                        drawBorder: false
                      },
                      ticks: {
                        maxTicksLimit: 6
                      },
                      maxBarThickness: 25,
                    }],
                    yAxes: [{
                      ticks: {
                        maxTicksLimit: 5,
                        padding: 10,
                      },
                      gridLines: {
                        color: "rgb(234, 236, 244)",
                        zeroLineColor: "rgb(234, 236, 244)",
                        drawBorder: false,
                        borderDash: [2],
                        zeroLineBorderDash: [2]
                      }
                    }],
                  },
                },
              });
    },
        error: function() {
                console.log("No se ha podido obtener la información");
            }
        });
    
        }
    
        $( "#lerny_select" ).change(function() {
            $( "#lerny_name" ).text($( "#lerny_select" ).children("option:selected").text())
            $( "#microlerny_select" ).show()
            $('#microlerny_select').children().remove().end()
            .append('<option selected value="-1">Todos los Microlerny</option>') ;
            var lerny_id = $( "#lerny_select" ).children("option:selected").val();
            $.ajax({
                method: 'POST',
                url: '/api_lerny/microlernyapi/',
                data: { pk: lerny_id },
                success: function(data) {
                    for(var i = 0; i < Object.keys(data).length; i++) {
                        document.getElementById("microlerny_select").innerHTML += "<option value='"+data[i].pk+"'>"+data[i].name+"</option>";
                    }
                },
                error: function() {
                    console.log("No se ha podido obtener la información");
                }
            });
        });
    
        $(document).ready(function() {
    
            table = $('#dataTable').DataTable( {
                ajax: {
                    url: '/api_lerny/lernydetail/?lerny_id=-1&microlerny_id=-1',
                    type: 'GET',
                    dataType: 'json'
                },
                columns :[
                {data: 'identification'},
                {data: 'user'},
                {data: 'done'},
                {data: 'progress'},
    
                ],
                searchPanes: {
                    layout: 'columns-1',
                    columns: [0,1,2]
                },
                dom: '<"dtsp-dataTable"frtip>',
                pageLength: 20
            })
    
            table.searchPanes();
            $("div.dtsp-verticalPanes").append(table.searchPanes.container());
        })
    
        $.ajax({
            url: '/api_lerny/lernyapi/',
            success: function(data) {
                for(var i = 0; i < Object.keys(data).length; i++) {
                    document.getElementById("lerny_select").innerHTML += "<option value='"+data[i].pk+"'>"+data[i].name+"</option>";
                }
    
                $( "#lerny_name" ).text(data[0].name)
            },
            error: function() {
                console.log("No se ha podido obtener la información");
            }
        });
    
      </script>
    
</body>



</html>